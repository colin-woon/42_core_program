Refactored code and checked all functions
